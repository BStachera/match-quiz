<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Match Quiz â€” czy pasujemy?</title>
<meta name="description" content="Ustaw swoje preferencje, wygeneruj link i wyÅ›lij. Ona odpowie na 5 pytaÅ„, a system policzy zgodnoÅ›Ä‡. Zero spiny, czysta zabawa.">
<!-- Kolory przeglÄ…darek / paskÃ³w -->
<meta name="theme-color" content="#0b0f1a" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#0f1629" media="(prefers-color-scheme: light)">
<meta name="msapplication-navbutton-color" content="#0b0f1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="color-scheme" content="dark light">
<!-- Ikony -->
<link rel="icon" type="image/png" href="favicon.png" sizes="32x32">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="site.webmanifest">
<!-- Open Graph / Twitter -->
<meta property="og:title" content="Match Quiz â€” zagraj ze mnÄ…!" />
<meta property="og:description" content="5 pytaÅ„, wyniki zgodnoÅ›ci i zero spiny. SprawdÅºmy, czy pasujemy ğŸ’«" />
<meta property="og:image" content="icon.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<!-- CSP (bezpieczeÅ„stwo) -->
<meta http-equiv="Content-Security-Policy"
  content="default-src 'self'; img-src 'self' data:; media-src 'none'; font-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'self'; frame-src 'none'; base-uri 'none'; form-action 'none'">

<style>
  /* iOS: nie powiÄ™kszaj tekstu i nie rÃ³b auto-zoomu na inputach */
html { -webkit-text-size-adjust: 100%; }

/* Minimalny rozmiar fontu w polach formularza = 16px (prÃ³g iOS) */
input[type="text"],
input[type="url"],
input[type="tel"],
textarea,
select {
  font-size: 16px;           /* kluczowe â€“ zatrzymuje auto-zoom */
  line-height: 1.25;
  min-height: 44px;          /* wygodny tap target */
}

/* Opcjonalnie: tylko dla Safari/iOS (gdybyÅ› nie chciaÅ‚ wpÅ‚ywaÄ‡ na inne przeglÄ…darki) */
@supports (-webkit-touch-callout: none) {
  input[type="text"],
  input[type="url"],
  input[type="tel"],
  textarea,
  select { font-size: 16px !important; }
}
:focus-visible { outline: 2px solid rgba(0,229,255,.6); outline-offset: 2px; }

  :root{
    --bg1:#0b0f1a; --bg2:#131a2a; --neon1:#00e5ff; --neon2:#ff3af2; --txt:#e8f0ff;
    --card:#0f1629aa; --accent:#7df9ff; --ok:#33ff88; --bad:#ff4d6d; --overlay:rgba(0,0,0,.72);
  }
  html, body { background-color:#0b0f1a; min-height:100%; }
  body{
      padding-top: env(safe-area-inset-top);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
    margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    color:var(--txt);
    background:
      radial-gradient(1200px 800px at 20% 10%, #111936 0%, transparent 60%),
      radial-gradient(1000px 800px at 80% 80%, #1a1033 0%, transparent 55%),
      linear-gradient(135deg, var(--bg1), var(--bg2));
    letter-spacing:.2px;
    overscroll-behavior: none;
    padding-left:  env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
  }
  /* StaÅ‚e tÅ‚o (fix biaÅ‚ych â€rogÃ³wâ€ w Safari) */
  body::before{
    content:""; position: fixed; inset: 0; z-index:-1; pointer-events:none;
    background:
      radial-gradient(1200px 800px at 20% 10%, #111936 0%, transparent 60%),
      radial-gradient(1000px 800px at 80% 80%, #1a1033 0%, transparent 55%),
      linear-gradient(135deg, #0b0f1a, #131a2a);
    background-repeat: no-repeat;
  }

  .wrap{max-width:980px; margin:0 auto; padding:24px}
  .title{margin-bottom:15px; font-size:clamp(28px,6vw,48px); font-weight:800; line-height:1.05; text-transform:uppercase;
    text-shadow:0 0 12px var(--neon2), 0 0 22px var(--neon1)}
  .subtitle{opacity:.95; margin-top:6px; margin-bottom:15px}
  .grid{display:grid; gap:16px; margin-top:15px}
  .card{background:var(--card); backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.08);
    border-radius:18px; padding:18px; box-shadow:0 12px 40px rgba(0,0,0,.35)}
  .btn{display:inline-block; padding:12px 18px; border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    color:var(--txt); text-decoration:none; cursor:pointer; font-weight:700; letter-spacing:.4px; text-align:center;
    transition: transform .06s ease, box-shadow .2s ease, border-color .2s}
  .btn:hover{transform: translateY(-1px); box-shadow:0 0 18px var(--neon1); border-color: var(--accent)}
  .btn.primary{margin-top:20px; background:linear-gradient(180deg, rgba(0,229,255,.18), rgba(255,58,242,.15))}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  input[type="text"], input[type="url"]{
    margin-top:10px; width:90%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:#0d1324; color:var(--txt)
  }
  .hint{font-size:13px; opacity:.8}
  .pill{display:inline-block; width:auto; max-width:max-content; padding:6px 10px; border-radius:999px;
    background:rgba(0,229,255,.12); font-size:13px}
  .options{display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(200px,1fr))}
  .opt{padding:12px; border-radius:14px; background:#0b1222; border:1px solid rgba(255,255,255,.10); cursor:pointer; outline:none}
  .opt:hover{border-color: var(--accent)}
  .opt.selected{border-color: var(--neon2); box-shadow:0 0 16px rgba(255,58,242,.35)}
  .opt:focus{box-shadow:0 0 0 3px rgba(0,229,255,.35), 0 0 0 1px rgba(255,255,255,.2) inset}
  .center{text-align:center}
  .muted{opacity:.75}
  .glow{color:var(--neon1); text-shadow:0 0 14px var(--neon1)}
  .mono{font-variant-numeric: tabular-nums}
  .url-grid{display:grid; grid-template-columns:1fr 1fr; gap:20px; align-items:center}
  .url-row{display:flex; gap:10px; align-items:center}
  .qr-box{margin-left: 12px; width:280px; aspect-ratio:1/1; background:#fff; padding:10px; border-radius:12px;
    display:grid; place-items:center; box-shadow:0 6px 30px rgba(0,0,0,.25)}
  #qrcode canvas{background:#fff}

  /* MODAL â€“ â€O co chodzi?â€ */
.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,.65);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal.show { display:flex; }

.modal .sheet {
  background: var(--card);
  border-radius: 16px;
  padding: 18px;
  width: calc(100% - 10px);   /* po 5px marginesu z lewej i prawej */
  max-width: 720px;
  height: 90%;                /* 90% wysokoÅ›ci ekranu */
  margin: auto;
  display: flex;
  flex-direction: column;
  overflow-y: auto;           /* przewijanie gdy treÅ›ci jest za duÅ¼o */
  box-shadow: 0 12px 40px rgba(0,0,0,.35);
}


  /* Motion reduce */
  @media (prefers-reduced-motion: reduce){
    *{transition:none!important; animation:none!important}
  }
  @media (max-width:700px){
    .wrap{padding:16px}
    .options{grid-template-columns:1fr}
    .btn{width:100%}
    .url-grid{grid-template-columns:1fr}
    .url-row{flex-direction:column; align-items:stretch}
  }
</style>
<script src="qrcode.min.js"></script>
</head>
<body>
  <script>
/*! LZ-String (only URI methods) â€“ https://github.com/pieroxy/lz-string */
const LZString=(function(){function o(o,r){if(!t[o]){t[o]={};for(let n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={compressToEncodedURIComponent:function(t){return null==t?"":e._compress(t,6,function(t){return n.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:e._decompress(t.length,32,function(e){return o(n,t.charAt(e))})},_compress:function(o,n,t){if(null==o)return"";var e,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==n-1?(v=0,d.push(t(m)),m=0):v++;for(i=a.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1}else{for(i=1,e=0;e<h;e++)m=m<<1|i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i=0;for(i=a.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(i=s[a],e=0;e<h;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==n-1?(v=0,d.push(t(m)),m=0):v++;for(i=a.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1}else{for(i=1,e=0;e<h;e++)m=m<<1|i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i=0;for(i=a.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(i=s[a],e=0;e<h;e++)m=m<<1|1&i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(i=1,e=0;e<h;e++)m=m<<1|i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i=0;for(i=2,e=0;e<h;e++)m=m<<1|i,v==n-1?(v=0,d.push(t(m)),m=0):v++,i=0;for(;;){if(m<<=1,v==n-1){d.push(t(m));break}v++}return d.join("")},_decompress:function(o,n,t){var e,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:t(0),position:n,index:1};for(i=0;i<3;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=t(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),s=v,0==--h&&(h=Math.pow(2,m),m++)}}
})();</script>

  <div class="wrap" id="app"></div>

<!-- Modal -->
<div class="modal" id="aboutModal" aria-hidden="true">
  <div class="card sheet" role="dialog" aria-labelledby="aboutTitle" aria-modal="true">
    <div class="row" style="justify-content:space-between; align-items:flex-end">
      <div id="aboutTitle" class="title" style="font-size:28px; margin:0">Dlaczego powstaÅ‚ Match Quiz?</div>
      <button class="btn" id="closeAbout" aria-label="Zamknij okno">Zamknij</button>
    </div>

    <div class="grid" style="gap:10px; margin-top:12px">

      <!-- Historia / geneza -->
      <p class="subtitle" style="margin-bottom:6px">
        <b>KrÃ³tka gra = dobry start.</b> Z rozmÃ³w ze znajomymi i wÅ‚asnych doÅ›wiadczeÅ„: pierwsze â€hejâ€ bywa niezrÄ™czne,
        a algorytmy nie pomagajÄ… przeÅ‚amaÄ‡ lodÃ³w. ChcieliÅ›my daÄ‡ coÅ› prostego, wspÃ³lnego i lekkiego â€”
        stÄ…d pomysÅ‚ na 5-pytaÅ„, ktÃ³re od razu tworzÄ… temat do rozmowy.
      </p>

      <!-- Dlaczego dziaÅ‚a -->
      <p style="margin:0">
        Psychologicznie wspÃ³lne dziaÅ‚anie (tu: mini-gra) obniÅ¼a barierÄ™, a wynik staje siÄ™ naturalnym
        pretekstem: â€Serio wolisz sushi od pizzy?â€ â€” to brzmi lepiej niÅ¼ kolejny suchy small talk.
        To nie test zgodnoÅ›ci â€” to <b>zabawa i pretekst do rozmowy</b>.
      </p>

      <!-- Jak dziaÅ‚a â€“ 3 kroki -->
      <div style="margin-top:8px">
        <strong>Jak to dziaÅ‚a (3 kroki):</strong>
        <ol style="margin:6px 0 0 18px">
          <li>Ustaw imiÄ™, opcjonalnie kontakt i odpowiedz na 5 pytaÅ„.</li>
          <li>Wygeneruj link lub QR i wyÅ›lij / pokaÅ¼.</li>
          <li>Druga osoba klika, odpowiada i dostajecie procent zgodnoÅ›ci.</li>
        </ol>
      </div>

      <!-- Zastosowania -->
      <div style="margin-top:8px">
        <strong>Gdzie siÄ™ sprawdzi?</strong>
        <ul style="margin:6px 0 0 18px">
          <li>Na start w aplikacjach randkowych â€” szybki, kreatywny icebreaker.</li>
          <li>Jako Å¼art lub wyzwanie dla znajomych â€” linkiem albo QR-kodem.</li>
          <li>Na zdjÄ™ciu profilowym â€” dodaj QR, by kaÅ¼dy mÃ³gÅ‚ zeskanowaÄ‡.</li>
          <li>Offline â€” wydrukuj QR i zrÃ³b z nim zdjÄ™cie, to buduje wiarygodnoÅ›Ä‡ (nie wyglÄ…dasz jak fejk ğŸ˜„).</li>
        </ul>
      </div>

      <!-- PrywatnoÅ›Ä‡ -->
      <div style="margin-top:8px">
        <strong>PrywatnoÅ›Ä‡:</strong>
        <ul style="margin:6px 0 0 18px">
          <li><em>Zero serwera</em> â€” nic nie przechowujemy; wszystko liczy siÄ™ lokalnie w Twojej przeglÄ…darce.</li>
          <li>W linku zapisujemy tylko: imiÄ™/ksywkÄ™, opcjonalny kontakt i wybory do 5 pytaÅ„ (by druga osoba mogÅ‚a zagraÄ‡).</li>
          <li>Nie ma ciasteczek Å›ledzÄ…cych, analityki ani ukrytych skryptÃ³w.</li>
        </ul>
      </div>

      <!-- Praktyczne wskazÃ³wki -->
      <div style="margin-top:8px">
        <strong>Praktyczne wskazÃ³wki:</strong>
        <ul style="margin:6px 0 0 18px">
          <li>MoÅ¼esz <em>wysÅ‚aÄ‡ link</em>, ale pamiÄ™taj: niektÃ³re platformy (np. Tinder) ograniczajÄ… zewnÄ™trzne adresy.</li>
          <li>NajproÅ›ciej: <em>wstaw QR</em> (generowany tutaj) na swoje zdjÄ™cie â€” Å‚atwo go zeskanowaÄ‡.</li>
          <li>Lub <em>wydrukuj QR</em> i zrÃ³b z nim zdjÄ™cie â€” szybki sposÃ³b, by siÄ™ wyrÃ³Å¼niÄ‡ i potwierdziÄ‡ wiarygodnoÅ›Ä‡.</li>
        </ul>
      </div>

      <!-- Zasady -->
      <div style="margin-top:8px">
        <strong>Zasady:</strong> na luzie, bez spamu; jeÅ›li ktoÅ› nie chce graÄ‡ â€” szanuj to.
      </div>

      <!-- Jeden przycisk pomocy -->
      <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap">
        <button class="btn" id="aboutShare">Jak wstawiÄ‡ QR na zdjÄ™cie?</button>
      </div>

      <!-- Tip o jakoÅ›ci QR -->
      <div class="muted" style="margin-top:10px; font-size:13px">
        <em>Tip:</em> jeÅ›li chcesz wydrukowaÄ‡ QR w dobrej jakoÅ›ci, pobierz PNG 1000Ã—1000 z przycisku
        â€Pobierz QR PNGâ€ w kreatorze â€” ma biaÅ‚y margines i dobrze trzyma siÄ™ na zdjÄ™ciu/wydruku.
      </div>
    </div>
  </div>
</div>

<script>
/* PodpiÄ™cie akcji w modalu â€O co chodzi?â€ */
(function(){
  const modal  = document.getElementById('aboutModal');
  const close  = document.getElementById('closeAbout');
  const help   = document.getElementById('aboutShare');

  if (close) close.onclick = () => modal.classList.remove('show');

  if (help) help.onclick = () => {
    alert(
`Jak wstawiÄ‡ QR na zdjÄ™cie?

1) W kreatorze kliknij â€Pobierz QR PNGâ€ (plik 1000Ã—1000 z biaÅ‚ym marginesem).
2) OtwÃ³rz edytor zdjÄ™Ä‡ w telefonie (np. systemowy, Canva, PicsArt).
3) Wklej QR w rÃ³g zdjÄ™cia profilowego i zapisz.
4) Alternatywnie: wydrukuj QR i zrÃ³b z nim zdjÄ™cie â€” to wyglÄ…da wiarygodnie i wyrÃ³Å¼nia.

Uwaga: niektÃ³re aplikacje (np. Tinder) ograniczajÄ… linki â€” QR zwykle dziaÅ‚a bez problemu.`
    );
  };
})();
</script>


<script>
const el = s => document.querySelector(s);
const app = el('#app');

const QUESTIONS = [
  {q: 'Koncert czy kino?', a: ['HipHop koncert ğŸ¤','Kino ğŸ¬','Dom i Netflix ğŸ“º','Impreza ze znajomymi ğŸ»']},
  {q: 'Weekend marzeÅ„ toâ€¦', a: ['GÃ³ry ğŸ”','Morze ğŸŒŠ','Miasto nocÄ… ğŸŒƒ','Chill w lesie ğŸŒ²']},
  {q: 'Co wybierasz na kolacjÄ™?', a: ['Pizza ğŸ•','Sushi ğŸ£','Burger ğŸ”','SaÅ‚atka ğŸ¥—']},
  {q: 'Zwierzak idealny?', a: ['Kot ğŸ±','Pies ğŸ¶','Papuga ğŸ¦œ','Å»aden, wolÄ™ ludzi ğŸ˜']},
  {q: 'Styl Å¼ycia:', a: ['Ranny ptaszek â˜€ï¸','Nocny marek ğŸŒ™','Elastycznie ğŸ˜…','CiÄ™Å¼ko powiedzieÄ‡ ğŸ¤”']},
];

/* ===== utils ===== */
function encodeState(o){
  try{
    return LZString.compressToEncodedURIComponent(JSON.stringify(o));
  }catch(e){
    // awaryjnie stary format
    return btoa(unescape(encodeURIComponent(JSON.stringify(o))));
  }
}
function decodeState(hash){
  if(!hash) return null;
  // 1) sprÃ³buj nowy, skompresowany
  try{
    const raw = LZString.decompressFromEncodedURIComponent(hash);
    if (raw) return JSON.parse(raw);
  }catch(e){}
  // 2) wstecznie: stary base64
  try{
    return JSON.parse(decodeURIComponent(escape(atob(hash))));
  }catch(e){}
  return null;
}

function pct(n){ return Math.round(n*100) }
function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])) }
function escapeAttr(str=''){ return String(str).replace(/"/g,'&quot;') }

/* Walidacja i normalizacja kontaktu + czytelny display */
function normalizeContact(raw=''){
  if(!raw) return {ok:false};
  const s = raw.trim();

  // e-mail
  const emailRe = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i;
  if (s.toLowerCase().startsWith('mailto:')) {
    const addr = s.slice(7);
    if (emailRe.test(addr)) return {ok:true, href:'mailto:'+addr, display:addr};
    return {ok:false};
  }
  if (emailRe.test(s)) return {ok:true, href:'mailto:'+s, display:s};

  // telefon: 9â€“12 cyfr; + lub 00; spacje/kreski out; tel:
  const telClean = s.replace(/[\s-]/g,'');
  if (/^(?:tel:)?(?:(?:\+|00)?\d{9,12})$/i.test(telClean)) {
    const digits = telClean.replace(/^tel:/i,'');
    return {ok:true, href:'tel:'+digits, display:digits.replace(/^00/,'+')};
  }

  // URL â€“ dodaj https jeÅ›li brak
  let url; try { url = new URL(/^https?:\/\//i.test(s) ? s : 'https://'+s); } catch { return {ok:false}; }
  const host = url.hostname.replace(/^www\./,'').toLowerCase();
  const path = url.pathname;

  if (host==='wa.me' || host==='api.whatsapp.com'){ if (/^\/\+?\d{9,12}/.test(path)) return {ok:true, href:url.toString(), display:url.toString()}; return {ok:false}; }
  if (host==='instagram.com' && /^\/[A-Za-z0-9_.-]+\/?$/.test(path)) return {ok:true, href:url.toString(), display:'instagram.com'+path};
  if (host==='facebook.com') return {ok:true, href:url.toString(), display:'facebook.com'+path};
  if (host==='m.me' && /^\/[A-Za-z0-9_.-]+\/?$/.test(path)) return {ok:true, href:url.toString(), display:'m.me'+path};
  if (host==='messenger.com' && /^\/t\//.test(path)) return {ok:true, href:url.toString(), display:'messenger.com'+path};
  if ((host==='t.me' || host==='telegram.me') && /^\/[A-Za-z0-9_]{3,}/.test(path)) return {ok:true, href:url.toString(), display:'t.me'+path};
  if (host==='discord.gg' && /^\/[A-Za-z0-9]+/.test(path)) return {ok:true, href:url.toString(), display:'discord.gg'+path};
  if (host==='discord.com' && /^\/(users|channels)\//.test(path)) return {ok:true, href:url.toString(), display:'discord.com'+path};
  if (host==='tiktok.com' && /^\/@[^/]+/.test(path)) return {ok:true, href:url.toString(), display:'tiktok.com'+path};
  if ((host==='x.com' || host==='twitter.com') && /^\/[A-Za-z0-9_]{1,15}\/?$/.test(path)) return {ok:true, href:url.toString(), display:host+path};

  return {ok:false};
}

/* NagÅ‚Ã³wek: inny dla kreatora i gry */
function headerBlock(mode = 'creator', name = '') {
  const isGame = mode === 'game';
  const title   = isGame ? `Match Quiz <span class="glow">â€” czy pasujesz do ${escapeHtml(name)}?</span>`
                         : `Match Quiz <span class="glow">â€” czy pasujemy?</span>`;
  const sub     = isGame ? `Wybierz swoje odpowiedzi i zobacz, jak do siebie pasujecie.`
                         : `Ustaw swoje preferencje, wygeneruj link i wyÅ›lij. Ona odpowie na 5 pytaÅ„, a system policzy zgodnoÅ›Ä‡. Zero spiny, czysta zabawa.`;
  return `
    <div class="row" style="justify-content:space-between; align-items:flex-end">
      <div>
        <div class="title">${title}</div>
        <div class="subtitle">${sub}</div>
        <button class="btn" id="openAbout">O co chodzi?</button>
      </div>
    </div>`;
}

function wireAbout(){
  const modal = el('#aboutModal');
  const openBtn = el('#openAbout');
  const closeBtn = el('#closeAbout');
  if (openBtn) openBtn.onclick = ()=> modal.classList.add('show');
  if (closeBtn) closeBtn.onclick = ()=> modal.classList.remove('show');
  modal.addEventListener('click', e => { if(e.target === modal) modal.classList.remove('show'); });
}

/* Haptics */
  /* Lekka wibracja 1x â€“ klik opcji */
function buzz(ms = 12){
  if (navigator.vibrate) { try{ navigator.vibrate(ms); }catch{} }
}

/* Wibracje wyniku â€“ moc zaleÅ¼na od % (0â€“100) */
function resultBuzz(score){
  if (!navigator.vibrate) return;
  // Skaluje liczbÄ™ impulsÃ³w 1â€“6 i dÅ‚ugoÅ›Ä‡ impulsu 15â€“40 ms
  const pulses = Math.max(1, Math.min(6, Math.round(score / 17))); // ~0..6
  const dur    = Math.round(15 + (score/100) * 25);                // 15..40 ms
  const gap    = 18;                                               // przerwy

  // Zbuduj pattern: [dur, gap, dur, gap, ...]
  const pattern = [];
  for(let i=0;i<pulses;i++){ pattern.push(dur); if(i<pulses-1) pattern.push(gap); }

  try{ navigator.vibrate(pattern); }catch{}
}


/* A11y: klawiatura dla opcji */
function addOptionA11y(scope){
  scope.querySelectorAll('.opt').forEach(opt=>{
    opt.setAttribute('tabindex','0');
    opt.setAttribute('role','button');
    opt.addEventListener('keydown', e=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault(); opt.click();
      }
    });
  });
}

/* ========== KREATOR ========== */
function viewCreator(prefillAnswers=null){
  app.innerHTML = `
    <div class="grid" style="gap:18px">
      ${headerBlock('creator')}
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="pill">TRYB KREATORA</div>
        </div>
        <div class="grid" style="gap:14px">
          <label>
            <div class="small muted">Twoje imiÄ™ / ksywka:</div>
            <input id="name" type="text" placeholder="np. Piotr" />
          </label>
          <label>
            <div class="small muted">Link do kontaktu:</div>
            <input id="contact" type="url" placeholder="np. tel:+48123456789 / wa.me/48â€¦ / nick@domena.pl / instagram.com/nick / x.com/nick" />
            <div class="hint" id="contactHint"></div>
          </label>
        </div>
      </div>

      <div class="card">
        <div class="pill">Twoje odpowiedzi</div>
        <div class="grid" style="gap:16px">
          ${QUESTIONS.map((qq, qi)=>`
            <div>
              <div class="mono" style="opacity:.9; font-weight:700; margin-bottom:8px">${qi+1}. ${qq.q}</div>
              <div class="options" data-q="${qi}">
                ${qq.a.map((txt, ai)=>`<div class="opt" data-a="${ai}">${txt}</div>`).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        <div class="row">
          <button class="btn primary" id="gen">ğŸ”— Generuj link + QR</button>
          <button class="btn ghost" id="reset">WyczyÅ›Ä‡</button>
        </div>

        <div id="linkBox" class="grid" style="gap:8px; margin-top:12px; display:none">
          <div class="card url-grid" style="background:transparent; box-shadow:none; border:0; padding:0">
            <div class="url-col">
              <input id="shareUrl" type="text" readonly class="mono" style="width:90%" />
              <div class="url-row">
                <a class="btn" id="openQuiz" style="margin-top: 10px; width:88%; text-align:center;">Zobacz quiz</a>
                <button class="btn" id="copy">Kopiuj</button>
                <button class="btn" id="share" style="display:none">UdostÄ™pnij</button>
              </div>
            </div>
            <div class="center">
              <div class="qr-box" id="qrExport"><div id="qrcode"></div></div>
              <div class="small muted" id="qrCaption"></div>
              <button class="btn" id="saveqr" style="margin-top:8px">Pobierz QR PNG</button>
            </div>
          </div>
        </div>
      </div>
    </div>`;

  wireAbout();

  const chosen = Array(QUESTIONS.length).fill(null);

  // Prefill wyborÃ³w z gry (jeÅ›li sÄ…)
  if (Array.isArray(prefillAnswers) && prefillAnswers.length === QUESTIONS.length){
    prefillAnswers.forEach((ai, qi)=>{
      const box = app.querySelector(`.options[data-q="${qi}"]`);
      if(box){
        const opt = box.querySelector(`.opt[data-a="${ai}"]`);
        if(opt){ opt.classList.add('selected'); chosen[qi]=ai; }
      }
    });
  }

  app.querySelectorAll('.options').forEach(box=>{
    addOptionA11y(box);
    box.addEventListener('click', (e)=>{
      const opt = e.target.closest('.opt'); if(!opt) return;
      const qi = +box.dataset.q; const ai = +opt.dataset.a;
      chosen[qi] = ai;
      box.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));
      opt.classList.add('selected');
      buzz();
    });
  });

  el('#reset').onclick = ()=> viewCreator();

  el('#gen').onclick = ()=>{
    const name = el('#name').value.trim() || 'Autor';
    const contactRaw = el('#contact').value.trim();
    let contact = '';
    const hint = el('#contactHint');

    if (contactRaw){
      const norm = normalizeContact(contactRaw);
      if (!norm.ok){
        hint.textContent = 'âš ï¸ Niedozwolony kontakt. Dozwolone: tel (9â€“12 cyfr, +/00), WhatsApp, IG, FB/Messenger, Telegram, Discord, TikTok, X/Twitter, e-mail.';
        hint.style.color = '#ff8888';
        return;
      } else {
        hint.textContent = '';
        contact = norm.href; // zapisujemy znormalizowany href
      }
    }

    if(chosen.some(x=>x===null)){
      alert('UzupeÅ‚nij wszystkie odpowiedzi.');
      return;
    }

    const payload = {version:1, name, contact, answers: chosen};
    const hash = encodeState(payload);
    const url = location.origin + location.pathname + '#' + hash;
    el('#shareUrl').value = url;

    // QR
    if(typeof QRCode === 'function'){
      const qrWrap = el('#qrcode'); qrWrap.innerHTML = '';
      new QRCode(qrWrap, {text:url, width:240, height:240, colorDark:'#000', colorLight:'#ffffff', correctLevel: QRCode.CorrectLevel.M});
      el('#qrCaption').textContent = 'match-quiz + ' + name;
    }

    // Przyciski
    el('#copy').onclick = async ()=>{ try{ await navigator.clipboard.writeText(el('#shareUrl').value); }catch(e){} };
    el('#openQuiz').onclick = ()=>{ const u = el('#shareUrl').value; if(u) window.open(u, '_blank', 'noopener'); };
    if (navigator.share){
      const shareBtn = el('#share'); shareBtn.style.display='inline-block';
      shareBtn.onclick = ()=> navigator.share({title:'Match Quiz', text:`Zagraj ze mnÄ…: ${name}`, url});
    }

    el('#saveqr').onclick = ()=>{
      const CANVAS_SIZE = 1000, SCALE = 0.85;
      const QR_SIZE = Math.round(CANVAS_SIZE*SCALE);
      const OFFSET = Math.round((CANVAS_SIZE-QR_SIZE)/2);

      const canvas = document.createElement('canvas');
      canvas.width = CANVAS_SIZE; canvas.height = CANVAS_SIZE;
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingEnabled = false;
      ctx.fillStyle = '#fff'; ctx.fillRect(0,0,CANVAS_SIZE,CANVAS_SIZE);

      const tmp = document.createElement('div'); tmp.style.position='absolute'; tmp.style.left='-9999px';
      document.body.appendChild(tmp);
      new QRCode(tmp, {text:url, width:QR_SIZE, height:QR_SIZE, colorDark:'#000', colorLight:'#fff', correctLevel:QRCode.CorrectLevel.M});
      const qrCanvas = tmp.querySelector('canvas');
      if(qrCanvas) ctx.drawImage(qrCanvas, OFFSET, OFFSET);
      document.body.removeChild(tmp);

      const outName = (el('#name').value.trim() || 'Autor');
      ctx.fillStyle='#000'; ctx.textAlign='center'; ctx.font='40px monospace';
      ctx.fillText('match-quiz + ' + outName, CANVAS_SIZE/2, CANVAS_SIZE-20);

      const a=document.createElement('a'); a.download='match-quiz.png'; a.href=canvas.toDataURL('image/png'); a.click();
    };

    el('#linkBox').style.display='grid';
  };
}

/* ========== GRA ========== */
function viewGame(data){
  const name = data.name || 'Autor';
  let step = 0;
  const picked = Array(QUESTIONS.length).fill(null);

  const render = ()=>{
    const q = QUESTIONS[step];
    app.innerHTML = `
      <div class="grid" style="gap:18px">
        ${headerBlock('game', name)}
        <div class="card">
          <div class="mono" style="opacity:.9; font-weight:800; font-size:18px; margin-bottom:8px">${step+1}. ${q.q}</div>
          <div class="options" data-q="${step}">
            ${q.a.map((t,i)=>`<div class="opt" data-a="${i}">${t}</div>`).join('')}
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="back" ${step===0?'disabled style="opacity:.4;cursor:not-allowed"':''}>Wstecz</button>
            <div style="flex:1"></div>
            <button class="btn primary" id="next">${step===QUESTIONS.length-1?'PokaÅ¼ wynik':'Dalej â†’'}</button>
          </div>
        </div>
        <div class="center muted small">Grasz o: <span class="glow">${escapeHtml(name)}</span></div>
      </div>`;

    wireAbout();
    addOptionA11y(app);

    app.querySelector('.options').addEventListener('click', e=>{
      const o = e.target.closest('.opt'); if(!o) return;
      picked[step] = +o.dataset.a;
      app.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));
      o.classList.add('selected');
      buzz();
    });
    el('#back')?.addEventListener('click', ()=>{ if(step>0){ step--; render(); } });
    el('#next').addEventListener('click', ()=>{
      if(picked[step]===null){ alert('Zaznacz odpowiedÅº.'); return; }
      if(step<QUESTIONS.length-1){ step++; render(); } else { showResult(); }
    });
  };

  const showResult = ()=>{
    
    let matches=0;
    for(let i=0;i<QUESTIONS.length;i++){ if((data.answers||[])[i]===picked[i]) matches++; }
    const score = pct(matches/QUESTIONS.length);
    const normContact = normalizeContact(data.contact || '');
    const contactBtn  = normContact.ok ? `<a class="btn primary" href="${escapeAttr(normContact.href)}" target="_blank" rel="noopener">ğŸ’¬ Napisz do ${escapeHtml(name)}</a>` : '';
    const contactText = normContact.ok ? `<div class="muted" style="margin-top:8px; user-select:all;">Kontakt: ${escapeHtml(normContact.display || normContact.href)}</div>` : '';
    app.innerHTML = `
      <div class="grid" style="gap:18px">
        ${headerBlock('game', name)}
        <div class="card center">
          <div class="mono glow" style="font-size:56px; font-weight:900">${score}%</div>
          <div class="grid" style="gap:10px; margin-top:12px">
            ${QUESTIONS.map((qq,i)=>{
              const ok = (data.answers||[])[i]===picked[i];
              const you = qq.a[(data.answers||[])[i]];
              const her = qq.a[picked[i]];
              return `<div class="row small mono"><div style="width:20px">${i+1}.</div>
                <div class="muted">${qq.q}</div>
                <div class="mono" style="margin-left:6px">
                  <span style="color:${ok?'var(--ok)':'var(--bad)'}">${ok?'âœ”ï¸ Zgodne':'âœ–ï¸ RÃ³Å¼ne'}</span>
                  <span class="muted"> â€” Ty: ${escapeHtml(her)} | ${escapeHtml(name)}: ${escapeHtml(you)}</span>
                </div></div>`;
            }).join('')}
          </div>
          <div class="row" style="justify-content:center; margin-top:14px">
            ${contactBtn}
          </div>
          ${contactText}
        </div>
        <div class="center">
          <a class="btn" id="makeOwn">StwÃ³rz wÅ‚asny quiz</a>
        </div>
      </div>`;
    resultBuzz(score); // ğŸ”Š intensywnoÅ›Ä‡ zaleÅ¼na od wyniku
    wireAbout();

    // Prefill do kreatora
    el('#makeOwn').onclick = ()=>{
      try{ sessionStorage.setItem('prefillAnswers', JSON.stringify(picked)); }catch{}
      history.replaceState({}, '', location.pathname);
      viewCreator(picked);
    };
  };

  render();
}

/* ========== START ========== */
(function init(){
  // Prefill z poprzedniej gry
  let prefill = null;
  try{
    const raw = sessionStorage.getItem('prefillAnswers');
    if(raw){ prefill = JSON.parse(raw); sessionStorage.removeItem('prefillAnswers'); }
  }catch{}

  const hash = location.hash.replace(/^#/,'');
  if(!hash){ viewCreator(prefill); return; }
  const data = decodeState(hash);
  if(!data || !Array.isArray(data.answers) || data.answers.length!==QUESTIONS.length){
    history.replaceState({}, '', location.pathname);
    viewCreator(prefill); return;
  }
  viewGame(data);
})();

/* PWA: rejestracja service workera */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', ()=> navigator.serviceWorker.register('sw.js').catch(()=>{}));
}
</script>
</body>
</html>
