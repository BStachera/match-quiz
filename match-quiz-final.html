<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Match Quiz — czy pasujemy?</title>
<meta name="description" content="Ustaw swoje preferencje, wygeneruj link i wyślij. Ona odpowie na 5 pytań, a system policzy zgodność. Zero spiny, czysta zabawa.">
<style>
  :root{
    --bg1:#0b0f1a; --bg2:#131a2a; --neon1:#00e5ff; --neon2:#ff3af2; --txt:#e8f0ff;
    --card:#0f1629aa; --accent:#7df9ff; --ok:#33ff88; --bad:#ff4d6d; --overlay:#0b0f1acc;
  }
  html,body{height:100%}
  body{
    margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    color:var(--txt);
    background: radial-gradient(1200px 800px at 20% 10%, #111936 0%, transparent 60%),
               radial-gradient(1000px 800px at 80% 80%, #1a1033 0%, transparent 55%),
               linear-gradient(135deg, var(--bg1), var(--bg2));
    letter-spacing:.2px;
  }
  .wrap{max-width:980px; margin:0 auto; padding:24px}
  .title{font-size:clamp(28px, 6vw, 48px); font-weight:800; line-height:1.05; text-transform:uppercase; letter-spacing:1px;
    text-shadow:0 0 12px var(--neon2), 0 0 22px var(--neon1)
  }
  .subtitle{opacity:.95; margin-top:6px}
  .grid{display:grid; gap:16px}
  .card{background:var(--card); backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.08);
    border-radius:18px; padding:18px; box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset, 0 12px 40px rgba(0,0,0,.35)
  }
  .btn{display:inline-block; padding:12px 18px; border-radius:14px; border:1px solid rgba(255,255,255,.14);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); color:var(--txt);
    text-decoration:none; cursor:pointer; font-weight:700; letter-spacing:.4px; text-align:center;
    transition: transform .06s ease, box-shadow .2s ease, border-color .2s
  }
  .btn:hover{transform: translateY(-1px); box-shadow:0 0 18px var(--neon1); border-color: var(--accent)}
  .btn.primary{background:linear-gradient(180deg, rgba(0,229,255,.18), rgba(255,58,242,.15)); border-color: rgba(0,229,255,.5)}
  .btn.ghost{background:transparent}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  input[type="text"], input[type="url"]{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0d1324;
    color:var(--txt); outline:none; font-size:15px
  }
  .hint{font-size:13px; opacity:.8}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
    background:rgba(0,229,255,.12); border:1px solid rgba(0,229,255,.35); font-size:13px}
  .options{display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); margin-top:8px}
  .opt{padding:12px; border-radius:14px; background:#0b1222; border:1px solid rgba(255,255,255,.10); cursor:pointer; transition:border-color .15s, transform .05s}
  .opt:hover{border-color: var(--accent); transform: translateY(-1px)}
  .opt.selected{border-color: var(--neon2); box-shadow: 0 0 16px rgba(255,58,242,.35)}
  .progress{height:6px; background:#0a1020; border-radius:999px; overflow:hidden; margin:8px 0 2px}
  .bar{height:100%; width:0%; background: linear-gradient(90deg, var(--neon2), var(--neon1)); box-shadow: 0 0 18px var(--neon1)}
  .center{text-align:center}
  .muted{opacity:.75}
  .glow{color:var(--neon1); text-shadow: 0 0 14px var(--neon1)}
  .result{font-size:clamp(36px, 8vw, 72px); font-weight:900; letter-spacing:1px}
  .badge{display:inline-block; padding:6px 10px; border-radius:10px; font-size:12px; border:1px solid rgba(255,255,255,.18);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02))}
  .small{font-size:12px}
  .footer{opacity:.6; font-size:12px; margin-top:10px}
  .hr{height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent); margin:14px 0}
  .mono{font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1}
  .break{word-break: break-word; overflow-wrap:anywhere; white-space: normal}
  .url-grid{display:grid; grid-template-columns:1fr 1fr; gap:20px; align-items:center}
  .url-row{display:flex; gap:10px; align-items:center}
  .url-row .btn{min-width:140px}
  .url-col a{display:block}
  #qrcode canvas{padding:10px; background:#fff; border-radius:6px}
  @media (max-width: 700px){
    .wrap{padding:16px}
    .options{grid-template-columns: 1fr}
    .btn{width:100%}
    .url-grid{grid-template-columns:1fr}
    .url-row{flex-direction:column; align-items:stretch}
  }
</style>
<script src="qrcode.min.js"></script>
</head>
<body>
  <div class="wrap" id="app"></div>
<script>
const el = s=>document.querySelector(s); const app = el('#app');
const QUESTIONS = [
  {q: 'Koncert czy kino?', a: ['HipHop koncert 🎤','Kino 🎬','Dom i Netflix 📺','Impreza ze znajomymi 🍻']},
  {q: 'Weekend marzeń to…', a: ['Góry 🏔','Morze 🌊','Miasto nocą 🌃','Chill w lesie 🌲']},
  {q: 'Co wybierasz na kolację?', a: ['Pizza 🍕','Sushi 🍣','Burger 🍔','Sałatka 🥗']},
  {q: 'Zwierzak idealny?', a: ['Kot 🐱','Pies 🐶','Papuga 🦜','Żaden, wolę ludzi 😎']},
  {q: 'Styl życia:', a: ['Ranny ptaszek ☀️','Nocny marek 🌙','Elastycznie 😅','Ciężko powiedzieć 🤔']},
];
function encodeState(o){ return btoa(unescape(encodeURIComponent(JSON.stringify(o)))) }
function decodeState(b64){ try{ return JSON.parse(decodeURIComponent(escape(atob(b64)))) }catch(e){ return null } }
function pct(n){ return Math.round(n*100) }
function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])) }
function escapeAttr(str=''){ return String(str).replace(/"/g,'&quot;') }

function headerBlock(){
  return `
    <div class="row" style="justify-content:space-between; align-items:flex-end">
      <div>
        <div class="title">Match Quiz <span class="glow">— czy pasujemy?</span></div>
        <div class="subtitle">Ustaw swoje preferencje, wygeneruj link i wyślij. Ona odpowie na 5 pytań, a system policzy zgodność. Zero spiny, czysta zabawa.</div>
      </div>
    </div>`;
}

function viewCreator(){
  app.innerHTML = `
    <div class="grid" style="gap:18px">
      ${headerBlock()}
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="pill">TRYB KREATORA</div>
          <div class="small muted">Wszystko działa lokalnie, bez serwera.</div>
        </div>
        <div class="hr"></div>
        <div class="grid" style="gap:14px">
          <label>
            <div class="small muted">Twoje imię / ksywka (pokażemy je w grze):</div>
            <input id="name" type="text" placeholder="np. Piotr" autocomplete="name" />
          </label>
          <label>
            <div class="small muted">Link do kontaktu (np. WhatsApp, IG, Messenger):</div>
            <input id="contact" type="url" placeholder="np. https://wa.me/48XXXXXXXXX" />
            <div class="hint">Na ekranie wyniku pokażemy przycisk „Napisz do [Twoje imię]”.</div>
          </label>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:baseline">
          <div class="pill">Twoje odpowiedzi</div>
          <div class="small muted">Zaznacz po jednej opcji w każdym pytaniu.</div>
        </div>
        <div class="hr"></div>
        <div class="grid" style="gap:16px">
          ${QUESTIONS.map((qq, qi)=>`
            <div>
              <div class="mono" style="opacity:.9; font-weight:700; margin-bottom:8px">${qi+1}. ${qq.q}</div>
              <div class="options" data-q="${qi}">
                ${qq.a.map((txt, ai)=>`<div class="opt" data-a="${ai}">${txt}</div>`).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        <div class="hr"></div>
        <div class="row">
          <button class="btn primary" id="gen">🔗 Generuj link + QR</button>
          <button class="btn ghost" id="reset">Wyczyść</button>
        </div>

        <div id="linkBox" class="grid" style="gap:8px; margin-top:12px; display:none">
          <div class="card url-grid" style="background:transparent; box-shadow:none; border:0; padding:0">
            <div class="url-col">
              <a id="shareLink" target="_blank" class="mono break" style="margin-bottom:8px"></a>
              <input id="shareUrl" type="text" readonly style="position:absolute; left:-9999px; width:1px; height:1px" />
              <div class="url-row">
                <a class="btn" id="openQuiz" target="_blank" rel="noopener">Zobacz quiz</a>
                <button class="btn" id="copy">Kopiuj</button>
              </div>
            </div>
            <div class="center">
              <div id="qrcode" style="display:inline-block"></div>
              <div class="small muted" id="qrCaption" style="margin-top:8px"></div>
              <button class="btn" id="saveqr" style="margin-top:8px">Pobierz QR PNG</button>
            </div>
          </div>
        </div>
      </div>

      <div class="center muted footer">© Match Quiz — single‑file frontend. Dane liczone lokalnie, bez serwera.</div>
    </div>`;

  const chosen = Array(QUESTIONS.length).fill(null);
  app.querySelectorAll('.options').forEach(box=>{
    box.addEventListener('click', (e)=>{
      const opt = e.target.closest('.opt'); if(!opt) return;
      const qi = +box.dataset.q; const ai = +opt.dataset.a;
      chosen[qi] = ai;
      box.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));
      opt.classList.add('selected');
    });
  });

  el('#reset').onclick = ()=> viewCreator();
  el('#gen').onclick = ()=>{
    const name = el('#name').value.trim() || 'Autor';
    const contact = el('#contact').value.trim() || '';
    if(chosen.some(x=>x===null)){
      alert('Uzupełnij wszystkie odpowiedzi (5 pytań).');
      return;
    }
    const payload = {version:1, name, contact, answers: chosen};
    const hash = encodeState(payload);
    const url = location.origin + location.pathname + '#' + hash;
    el('#shareUrl').value = url;
    const link = el('#shareLink'); link.href = url; link.textContent = url;
    el('#openQuiz').href = url;

    // QR (Davidshimjs)
    if(typeof QRCode === 'function'){
      const qrWrap = el('#qrcode');
      qrWrap.innerHTML = '';
      new QRCode(qrWrap, {text:url, width:220, height:220, colorDark:'#000', colorLight:'#ffffff', correctLevel: QRCode.CorrectLevel.M});
      el('#qrCaption').textContent = 'match-quiz + ' + name;
    } else {
      el('#qrcode').innerHTML = '<div class="small muted">Brak qrcode.min.js — dodaj plik obok HTML.</div>';
    }

    el('#linkBox').style.display='grid';
  };
  el('#copy').onclick = async ()=>{
    try{ await navigator.clipboard.writeText(el('#shareUrl').value); alert('Skopiowano link 👍'); }
    catch(e){ alert('Nie udało się skopiować — skopiuj ręcznie.'); }
  };
  el('#saveqr').onclick = ()=>{
    const canvas = el('#qrcode')?.querySelector('canvas');
    const img = el('#qrcode')?.querySelector('img');
    let dataURL = '';
    if(canvas){ dataURL = canvas.toDataURL('image/png'); }
    else if(img){ dataURL = img.src; }
    if(!dataURL){ alert('Brak obrazu QR.'); return; }
    const a = document.createElement('a'); a.download='match-quiz.png'; a.href=dataURL; a.click();
  };
}

(function init(){
  const hash = location.hash.replace(/^#/,'');
  if(!hash){ viewCreator(); return; }
  const data = decodeState(hash);
  if(!data || !Array.isArray(data.answers) || data.answers.length!==QUESTIONS.length){
    alert('Niepoprawny link gry. Tworzymy nowy quiz.');
    history.replaceState({}, '', location.pathname);
    viewCreator();
    return;
  }
})();
</script>
</body>
</html>
